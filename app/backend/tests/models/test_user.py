import pytest

from app.models.user import User


@pytest.mark.asyncio
async def test_user_creation(db):
    user = User(
        first_name="Test",
        last_name="User",
        username="testuser",
        phone="+998901234567",
        hashed_password="hashed_secret",
    )
    db.add(user)
    await db.commit()
    await db.refresh(user)

    assert user.id is not None
    assert user.created_at is not None
    assert user.is_deleted is False


@pytest.mark.asyncio
async def test_soft_delete(db):
    user = User(
        first_name="Delete",
        last_name="User",
        username="deleteuser",
        phone="+998901234568",
        hashed_password="hashed_secret",
    )
    db.add(user)
    await db.commit()
    await db.refresh(user)

    user.is_deleted = True
    await db.commit()
    await db.refresh(user)

    assert user.is_deleted is True
